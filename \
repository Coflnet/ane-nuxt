<template>
  <FiltersNotificationSettingItem :filter="filter" :config="{
    notificationType: 'FireBase',
    predefinedValue: '',
    name: $t('webPush'),
    icon: 'tabler:mail',
    notTextInput: false
  }" :messages="{
    footer: $t('browserNotifications'),
  }" />
</template>

<script setup lang='ts'>
import { useFirebaseApp } from 'vuefire'
import { getMessaging, getToken } from 'firebase/messaging'
import type { Filter } from '~/types/FilterType';

const props = defineProps<{ filter: Filter }>()

const firebaseApp = useFirebaseApp()

watch(() => props.filter.notificationType, async (newValue) => {
  if (newValue === 'FireBase') {
    // akwav request in his frontend had a - in it
    props.filter.notificationTarget = '-'
  }

  if (!await checkPushNotificationPermissions()) {
    push.error("Getting persmissions for push notification failed please try again\nIf this continues please contact support")
    return;
  }

}, { immediate: true });

async function checkPushNotificationPermissions(): Promise<Boolean> {
  console.log('Requesting persmissions')

  Notification.requestPermission().then((permission) => {
    if (permission === 'granted') {
      console.log('Notification permission granted')
      return true;
    }
  })
  return false;
}

</script>
